<% const activePage = 'thong-ke' %>
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Thá»‘ng kÃª - Máº¦M NON XUÃ‚N KHOA</title>
  <link rel="stylesheet" href="/css/style.css" />
  <!-- âœ… Sá»­a lá»—i: XÃ³a khoáº£ng tráº¯ng dÆ° trong URL -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .chart-container {
      width: 80%;
      max-width: 800px;
      margin: 40px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 40px auto;
      max-width: 1000px;
    }
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      text-align: center;
      border-left: 5px solid #f39c12;
    }
    .stat-card h3 {
      color: #d35400;
      margin-bottom: 10px;
    }
    .stat-card p.value {
      font-size: 2rem;
      font-weight: bold;
      color: #e67e22;
    }
    .loader {
      text-align: center;
      padding: 50px;
      font-size: 1.2rem;
      color: #7f8c8d;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">ğŸŒ¼ Máº¦M NON XUÃ‚N KHOA</div>
    <nav>
  <ul>
    <li><a href="/" class="<%= activePage === 'trang-chu' ? 'active' : '' %>">Trang chá»§</a></li>
    
    <li class="dropdown">
      <a href="#" class="dropbtn <%= activePage === 'gioi-thieu' ? 'active' : '' %>">
        Giá»›i thiá»‡u <span class="arrow">â–¼</span>
      </a>
      <ul class="dropdown-content">
        <li><a href="/gioi-thieu-chung">Giá»›i thiá»‡u chung</a></li>
        <li><a href="/co-so-vat-chat">CÆ¡ sá»Ÿ váº­t cháº¥t</a></li>
        <li><a href="/doi-ngu-giao-vien">Äá»™i ngÅ© giÃ¡o viÃªn</a></li>
        <li><a href="/quan-diem-giao-duc">Quan Ä‘iá»ƒm giÃ¡o dá»¥c</a></li>
        <li><a href="/muc-tieu-dao-tao">Má»¥c tiÃªu Ä‘Ã o táº¡o</a></li>
      </ul>
    </li>

    <li><a href="/tuyen-sinh" class="<%= activePage === 'tuyen-sinh' ? 'active' : '' %>">Tuyá»ƒn sinh</a></li>
    <li><a href="/cong-khai" class="<%= activePage === 'cong-khai' ? 'active' : '' %>">CÃ´ng khai</a></li>
    <li><a href="/thong-ke" class="<%= activePage === 'thong-ke' ? 'active' : '' %>">Thá»‘ng kÃª</a></li>
    <li><a href="/lien-he" class="<%= activePage === 'lien-he' ? 'active' : '' %>">LiÃªn há»‡</a></li>
  </ul>
</nav>
  </header>

  <div class="container">
    <h1>ğŸ“Š Sá»‘ liá»‡u thá»‘ng kÃª chuyÃªn nghiá»‡p</h1>
    <p><em>Cáº­p nháº­t tá»« há»‡ thá»‘ng quáº£n lÃ½ há»c sinh â€“ Dá»¯ liá»‡u tá»± Ä‘á»™ng</em></p>

    <!-- âœ… DUY NHáº¤T 1 KHá»I Sá» LIá»†U Tá»”NG QUAN -->
    <div id="stats-cards" class="stats-grid">
      <div class="loader">Äang táº£i sá»‘ liá»‡u...</div>
    </div>

    <!-- Biá»ƒu Ä‘á»“ há»c sinh theo Ä‘á»™ tuá»•i -->
    <div class="chart-container">
      <h2>ğŸ‘¶ Há»c sinh theo Ä‘á»™ tuá»•i</h2>
      <canvas id="ageChart"></canvas>
    </div>

    <!-- Biá»ƒu Ä‘á»“ tÃ¬nh tráº¡ng há»c táº­p -->
    <div class="chart-container">
      <h2>ğŸ“ˆ TÃ¬nh tráº¡ng há»c táº­p</h2>
      <canvas id="progressChart"></canvas>
    </div>

    <p style="text-align: center; color: #7f8c8d; font-style: italic;">
      Cáº­p nháº­t: <span id="updateTime"></span>
    </p>
  </div>

  <!-- âœ… DUY NHáº¤T 1 SCRIPT: Gá»ŒI API + Váº¼ BIá»‚U Äá»’ -->
  <script>
    fetch('/api/stats')
      .then(res => res.json())
      .then(data => {
        // Cáº­p nháº­t táº¥t cáº£ sá»‘ liá»‡u vÃ o cÃ¹ng má»™t lÆ°á»›i
        document.getElementById('stats-cards').innerHTML = `
          <div class="stat-card">
            <h3>Tá»•ng há»c sinh</h3>
            <p class="value">${data.totalStudents}</p>
            <p>Äang theo há»c</p>
          </div>
          <div class="stat-card">
            <h3>NhÃ³m tuá»•i</h3>
            <p class="value">${data.ageGroups.length}</p>
            <p>Theo Ä‘á»™ tuá»•i</p>
          </div>
          <div class="stat-card">
            <h3>Sá»‘ lá»›p há»c</h3>
            <p class="value">${data.totalClasses}</p>
            <p>Hiá»‡n táº¡i</p>
          </div>
          <div class="stat-card">
            <h3>Sá»‘ giÃ¡o viÃªn</h3>
            <p class="value">${data.totalTeachers}</p>
            <p>Äang giáº£ng dáº¡y</p>
          </div>
          <div class="stat-card">
            <h3>Tá»· lá»‡ GV/HS</h3>
            <p class="value">1:${data.ratio}</p>
            <p>(GiÃ¡o viÃªn / Há»c sinh)</p>
          </div>
        `;

        // Cáº­p nháº­t thá»i gian
        document.getElementById('updateTime').textContent = new Date().toLocaleString();

        // Biá»ƒu Ä‘á»“: Theo Ä‘á»™ tuá»•i
        const ageCtx = document.getElementById('ageChart').getContext('2d');
        new Chart(ageCtx, {
          type: 'bar',
          data: {
            labels: data.ageGroups.map(d => d.label),
            datasets: [{
              label: 'Sá»‘ lÆ°á»£ng',
              data: data.ageGroups.map(d => d.value),
              backgroundColor: '#f39c12'
            }]
          },
          options: { responsive: true, scales: { y: { beginAtZero: true } } }
        });

        // Biá»ƒu Ä‘á»“: TÃ¬nh tráº¡ng
        const progressCtx = document.getElementById('progressChart').getContext('2d');
        new Chart(progressCtx, {
          type: 'pie',
          data: {
            labels: data.studentStatus.map(d => d.label),
            datasets: [{
              data: data.studentStatus.map(d => d.value),
              backgroundColor: ['#27ae60', '#f39c12', '#e74c3c']
            }]
          }
        });
      })
      .catch(err => {
        alert("Lá»—i táº£i sá»‘ liá»‡u! Vui lÃ²ng kiá»ƒm tra server.");
        console.error(err);
      });
  </script>

</body>
</html>